# Campaign & Lead Performance Analysis

## Table of contents
- [Project Overview](#project-overview)
- [Data Sources](#date-sources)
- [Data Querying](#data-querying)
- [Data visualisation](#data-visualisation)
- [References](#references)

### Project Overview
This project showcases SQL queries in PostgreSQL used for analysing campaign effectiveness, lead engagement, and email marketing performance. The dataset consists of multiple tables containing information about digital marketing campaigns, lead demographics, and engagement metrics. The dataset includes Campaign Data, Lead Data, Campaign Performance, and Region-Country Mapping tables. The analysis will incorporate joins, window functions, subqueries, CTEs, temporary tables, and table views.

---

### Data Sources
This dataset contains information about demand generation campaigns, lead data, and campaign performance metrics. It includes key details about campaigns (such as delivery channel, cost per lead, and target region), leads (with job titles, contact details, and subscription status), and campaign performance metrics (such as email delivery, opens, and unsubscribed). 

The dataset is designed to allow for relational analysis, where various tables are linked by IDs, enabling in-depth exploration of campaign efficiency, lead engagement, and overall marketing performance. The analysis will focus on identifying trends, understanding campaign effectiveness, and evaluating lead engagement, with the ability to join the data across different sheets for detailed insights.

#### Campaign Data
**Variable** | **Definition**
--- | ---
**Campaign ID** | Unique identifier for each campaign. (Primary key)
**Campaign Start** | Date when the campaign started.
**Completion Date** | Date when the campaign ended or was completed.
**NET Cost per Lead** | The net cost associated with acquiring each lead in the campaign.
**Lead Volume** | Total number of leads generated by the campaign.
**Region key** | Foreign key for geographic region where the campaign was run (e.g., North America, Europe).
**Country key** | Foreign key for country where the campaign was targeted or conducted.
**Industry** | Industry type the campaign is targeting (e.g., Technology, Healthcare).
**Campaign Delivery Channel** | How the campaign was delivered (e.g., Email, TM, Mixed).
**Organisation Employee Size** | Range of employee size for companies targeted by the campaign (e.g., 1-4, 5-50, etc.).

#### Lead Data
**Variable** | **Definition**
--- | ---
**Lead First Name** | First name of the lead.
**Lead Last Name** | Last name of the lead.
**Campaign ID** | The campaign ID that this lead is associated with (foreign key to Campaign Data).
**Job Title** | The job title of the lead (e.g., Manager, Director).
**Job Level** | The job level of the lead (e.g., Entry, Mid, Senior).
**Email Address** | The email address associated with the lead.
**Phone Number** | The phone number associated with the lead.
**Region ID** | Foreign key to the region data, mapping to the region of the campaign (e.g., 1).
**Country ID** | Foreign key to the country data, mapping to the country of the lead (e.g., 1).

#### Campaign Performance
**Variable** | **Definition**
--- | ---
**Campaign ID** | Unique identifier for each campaign (foreign key to Campaign Data).
**Email Delivered** | Total number of emails successfully delivered.
**Email Failed Delivery** | Number of emails that failed to be delivered.
**Opens** | Total number of times the campaign email was opened.
**Unique Opens** | Number of unique leads that opened the campaign email.
**Unique Clicks** | Number of unique leads who clicked on a link within the campaign email.
**Bounces** | Number of email bounces (failed email deliveries due to issues like invalid email addresses).
**Unsubscribed** | Number of leads who unsubscribed from the campaign.

#### Region Country Mapping
**Variable** | **Definition**
--- | ---
**Region ID** | Unique identifier for each region (e.g., 1).
**Region** | Name of the region (e.g., North America, Europe).
**Country ID** | Unique identifier for each country (e.g., 1).
**Country** | Name of the country (e.g., USA, Germany).

### Data Querying
#### 1. Campaign Effectiveness Analysis
##### Highest and Lowest Lead Volumes by Campaign
Querying the top 10 campaigns with the highest and lowest lead volumes:
```sql
SELECT campaignid, leadvolumeindustry
FROM campaign_data
ORDER BY leadvolumeindustry DESC
LIMIT 10;

SELECT campaignid, leadvolumeindustry
FROM campaign_data
ORDER BY leadvolumeindustry ASC
LIMIT 10;
```

##### Average Cost per Lead by Region and Country
Using a JOIN to map campaigns to their respective countries and regions:
```sql
SELECT region_country_mapping.country, region_country_mapping.region,
       ROUND(AVG(CAST(netcostperlead AS NUMERIC)),2) AS AvgCostPerLead
FROM campaign_data
LEFT OUTER JOIN region_country_mapping
ON campaign_data.countryid = region_country_mapping.countryid
GROUP BY region_country_mapping.country, region_country_mapping.region;
```

##### Total Cost per Campaign Across Regions
Aggregating the total cost for each region:
```sql
SELECT RCM.region, ROUND(SUM(CAST(CD.netcostperlead AS NUMERIC) * CAST(CD.leadvolumeindustry AS NUMERIC)),2) AS SumCost
FROM campaign_data CD
INNER JOIN region_country_mapping RCM
ON CD.regionid = RCM.regionid
GROUP BY RCM.region
ORDER BY SumCost DESC;
```

---

#### 2. Lead Engagement & Behaviour
##### Count of Leads Matching Specific Criteria
Filtering leads by email address and job attributes:
```sql
SELECT COUNT(*)
FROM lead_data
WHERE emailaddress LIKE '%tyler%' AND (joblevel ILIKE 'senior' OR jobtitle IN ('CEO', 'Director'));
```

##### Leads Generated Per Industry
```sql
SELECT CD.industry, COUNT(*) AS TotalLeadVolume
FROM lead_data LD
INNER JOIN campaign_data CD
ON LD.campaignid = CD.campaignid
GROUP BY CD.industry
ORDER BY TotalLeadVolume DESC;
```

##### Top 5 Job Titles Among Leads
```sql
SELECT jobtitle, COUNT(jobtitle) AS PopularJobs
FROM lead_data
GROUP BY jobtitle
ORDER BY PopularJobs DESC
LIMIT 5;
```

##### Distribution of Job Levels Across Industries
```sql
SELECT CD.industry, LD.joblevel, COUNT(*) AS JobLevelCount
FROM lead_data LD
INNER JOIN campaign_data CD
ON LD.campaignid = CD.campaignid
GROUP BY CD.industry, LD.joblevel
ORDER BY joblevel ASC;
```

##### Campaigns Generating High-Level Job Positions
```sql
SELECT campaignid, COUNT(*) AS TotalLeadVolume
FROM (
    SELECT *
    FROM lead_data
    WHERE jobtitle IN ('Director', 'CEO')
) AS HighLevelLeads
GROUP BY campaignid
ORDER BY TotalLeadVolume DESC;
```

---

#### 3. Email Marketing & Engagement Performance
##### Email Open Rate Per Campaign
```sql
SELECT
    campaignid,
    ROUND(CAST(opens AS NUMERIC) / CAST(emaildelivered AS NUMERIC) * 100, 2) AS OpenRate
FROM campaign_performance
ORDER BY OpenRate DESC;
```

##### Unique Click Rate by Region
```sql
SELECT
    RCM.region,
    ROUND(AVG(CAST(CP.uniqueclicks AS NUMERIC) / CAST(CP.emaildelivered AS NUMERIC) * 100),2) AS ClickRate
FROM campaign_performance CP
INNER JOIN campaign_data CD ON CP.campaignid = CD.campaignid
INNER JOIN region_country_mapping RCM ON CD.regionid = RCM.regionid
GROUP BY RCM.region
ORDER BY ClickRate DESC;
```

##### Campaign Rankings by Industry
```sql
WITH industrydata AS (
    SELECT CD.campaignid, CP.uniqueopens, CD.industry, CD.leadvolumeindustry,
           RANK() OVER (PARTITION BY industry ORDER BY uniqueopens DESC) AS ranklead
    FROM campaign_performance CP
    INNER JOIN campaign_data CD ON CP.campaignid = CD.campaignid
)
SELECT campaignid, uniqueopens, industry, leadvolumeindustry, ranklead
FROM industrydata
WHERE ranklead < 6
ORDER BY industry ASC;
```

##### Regional Campaign Performance Overview
Creating a temporary table to store performance metrics:
```sql
CREATE TEMP TABLE Temp_region_Performance AS
SELECT
    RCM.region,
    SUM(CP.opens) AS Total_opens,
    SUM(CP.uniqueclicks) AS Total_clicks,
    SUM(unsubscribed) AS Total_unsub
FROM region_country_mapping RCM
JOIN campaign_data CD ON RCM.regionid = CD.regionid
JOIN campaign_performance CP ON CP.campaignid = CD.campaignid
GROUP BY RCM.region;

SELECT *
FROM Temp_region_Performance
WHERE total_unsub < 150;
```

##### Campaign Performance View
```sql
CREATE VIEW Campaign_Performance_View AS
SELECT
    CD.campaignid,
    CD.industry,
    CD.leadvolumeindustry,
    CP.emaildelivered,
    CP.uniqueopens,
    ROUND(CAST(CP.uniqueopens AS NUMERIC) / CAST(CP.emaildelivered AS NUMERIC) * 100,2) AS Open_Rate,
    CP.uniqueclicks,
    ROUND(CAST(CP.uniqueclicks AS NUMERIC) / CAST(CP.emaildelivered AS NUMERIC) * 100,2) AS Click_Rate
FROM campaign_performance CP
INNER JOIN campaign_data CD ON CD.campaignid = CP.campaignid
ORDER BY click_rate DESC, open_rate DESC;
```

### Data Visualisation


### References

